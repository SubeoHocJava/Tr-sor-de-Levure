@model Web_WineShop.Models.ModelViewVoucher
<!-- Voucher Management Section -->
<div>
    <h1 class="h1-title text-center">Voucher Management</h1>
    <div class="container-fluid d-flex justify-content-end mt-2">
        <div class="d-flex align-items-center p-2">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="Search...">
                <button class="search-btn">
                    <i class="bi bi-search"></i>
                </button>
            </div>
            <div class="search-box">
                <button class="product-btn">
                    <i class="bi bi-plus"></i>
                    <i class="bi bi-list d-none"></i>
                </button>
            </div>
        </div>
    </div>
    <!-- Table Voucher -->
    <div class="container-fluid p-2">
        <table class="table table-bordered table-items">
            <thead>
                <tr>
                    <th><input type="checkbox" id="select-all"></th>
                    <th>ID</th>
                    <th>Voucher Name</th>
                    <th>DESCRIPTION</th>
                    <th>PERCENTAGE</th>
                    <th>MAX_DISCOUNT</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.vouchers)
                {
                    <tr>
                        <td><input type="checkbox" class="select-item"></td>
                        <td>@item.Id</td>
                        <td>@item.name</td>
                        <td>
                            <span data-bs-toggle="popover" title="@item.name"
                                  data-bs-content="@item.description">Hover me</span>
                        </td>
                        <td>@item.percentage</td>
                        <td>@item.maxDiscount</td>
                        <td class="actions">
                            <button class="btn btn-warning edit-btn">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-danger delete-btn">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <!-- Add New Voucher -->
        <div class="container row p-4 add-items d-none">
            <form id="voucher-form">
                <div class="mb-3">
                    <label for="voucherName" class="form-label">Voucher Name</label>
                    <input type="text" class="form-control" id="voucherName" placeholder="Enter voucher name">
                </div>
                <div class="mb-3">
                    <label for="voucherDescription" class="form-label">Description</label>
                    <textarea class="form-control" id="voucherDescription" rows="3"
                              placeholder="Enter description"></textarea>
                </div>
                <div class="mb-3">
                    <label for="percentage" class="form-label">Percentage</label>
                    <input type="number" class="form-control" id="percentage" placeholder="Enter percentage" min="1"
                           max="50">
                </div>
                <div class="mb-3">
                    <label for="maxDiscount" class="form-label">Max Discount</label>
                    <input type="text" class="form-control" id="maxDiscount" placeholder="Enter max discount">
                </div>
                <div class="mb-3">
                    <label for="expiration" class="form-label">Expiration Date</label>
                    <input type="date" class="form-control" id="expiration">
                </div>
            </form>
            <div>
                <button type="button" class="btn btn-secondary close-form-btn">Close</button>
                <button type="button" class="btn btn-primary save-form-btn">Save</button>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        function loadVoucherManagement() {
            fetch('/Admin/VoucherManagement')
                .then(response => response.text())
                .then(html => {
                    document.getElementById("main-content").innerHTML = html;
                    attachEvents();
                })
                .catch(error => console.error('Error loading partial view:', error));
        }

        function attachEvents() {
            // Save Voucher
            document.querySelector(".save-form-btn").addEventListener("click", function () {
                const formData = new FormData(document.getElementById("voucher-form"));
                fetch('/Admin/AddVoucher', {
                    method: 'POST',
                    body: formData
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert("Voucher added successfully!");
                            loadVoucherManagement();
                        } else {
                            alert("Error: " + data.message);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            });

            // Edit Voucher
            document.querySelectorAll(".edit-btn").forEach(btn => {
                btn.addEventListener("click", function () {
                    const id = this.closest("tr").querySelector("td:nth-child(2)").innerText;
                    console.log("Edit voucher ID:", id);
                    // Add edit logic here
                });
            });

            // Delete Voucher
            document.querySelectorAll(".delete-btn").forEach(btn => {
                btn.addEventListener("click", function () {
                    const id = this.closest("tr").querySelector("td:nth-child(2)").innerText;
                    if (confirm("Are you sure you want to delete this voucher?")) {
                        fetch(`/Admin/DeleteVoucher/${id}`, {
                            method: 'POST',
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    alert("Voucher deleted successfully!");
                                    loadVoucherManagement();
                                } else {
                                    alert("Error: " + data.message);
                                }
                            })
                            .catch(error => console.error('Error:', error));
                    }
                });
            });
        }

        loadVoucherManagement();
    });
</script>
